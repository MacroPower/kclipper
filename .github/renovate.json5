{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  extends: [
    "config:recommended",
    ":disableRateLimiting",
    ":separateMajorReleases",
    ":semanticCommits",
    ":automergeMinor",
  ],
  ignorePaths: [
    "**/testdata/**",
  ],
  postUpdateOptions: [
    "gomodTidy",
    "gomodUpdateImportPaths",
  ],
  customManagers: [
    {
      customType: "regex",
      managerFilePatterns: ["/(^|/).+/charts/charts\\.k$/"],
      matchStrings: [
        ".*\\{(\\n.*?)*[^\\}]*",
        '(.*\\n)*\\s*chart\\s*=\\s*"(?<depName>.+)"(.*\\n)*\\s*repoURL\\s*=\\s*"(?<registryUrl>.+)"(.*\\n)*\\s*targetRevision\\s*=\\s*"(?<currentValue>.+)"',
      ],
      matchStringsStrategy: "recursive",
      datasourceTemplate: "helm",
    },
    {
      customType: "regex",
      managerFilePatterns: ["/ci/main\\.go$/"],
      matchStrings: [
        '\\w+Version\\s*=\\s*"(?<currentValue>[^"]+)"\\s*//\\s*renovate:\\s*datasource=(?<datasource>[^\\s]+)\\s+depName=(?<depName>[^\\s]+)',
      ],
    },
  ],
  packageRules: [
    {
      matchDepTypes: ["golang"],
      automerge: false,
    },
    {
      matchFileNames: ["ci/main.go"],
      matchPackageNames: ["go"],
      automerge: false,
    },
    {
      matchManagers: ["custom.regex"],
      matchFileNames: ["**/charts/charts.k"],
      postUpgradeTasks: {
        commands: ['kcl chart update -q --chart="{{depName}}" --path="{{packageFileDir}}"'],
        executionMode: "update",
      },
    },
  ],
}
